
pragma circom 2.0.4;

template MiMC7_r(nrounds) {
    signal input x_in;
    signal input k;
    signal output out;

    var c[91] = [
        0,
        71681098274817563575241701135322814562066763833259765151484711333966944770327,
        99843818373476526391667249948180132899391258801466786337239432456705228707848,
        104363919729495407148674090257000667744520206632369411477796337580987530188548,
        104798570365821588158125902150320452026309541658088699849297357634457750485023,
        37097331576641991790321606565458120828439780132196258842233321321284577035785,
        3122612767525629338129170220481782655303798684717051611153444361134135214609,
        32899426035752021436719323130883190905728146209683103767226604777173820726061,
        49609460690301888907372466762621262739725728935946642544513829838181029708052,
        52097891490729034944210663052504821280891530614717930055665639603684213848869,
        92226327256730515217762549477062886622692548662516779740933142982034285003807,
        107005952885048519070964056234917288691378477008607644730074278259057006094852,
        1744927376719154648076930642700124611614619991594517131329832801373490375208,
        9692992239001754239384849887833429649164870521139484932252596296149949275394,
        102415008541143624625287252391863275929717382326314778793224320180971517625634,
        72918318706782621918805623034680334553767890350155427873467739615994366245162,
        84134327578966391046784251382410311872779767870510427189261217912935267290151,
        69475298696301164893349133595311677937971781467296742372845231337108176405542,
        76626511981508058837409900807569559347709417583688675328818140293099391300905,
        56575235817541896798685129865877433383837029372167366961449831836676113264386,
        16445780319481764909894946966195287415999880620333753264319101079292331284236,
        21340461184811938508342309861686994678376601671315130201447378055056717817632,
        68735082034817490276299953190574891283586814578481544462543550465157262183969,
        73841127446812839207815757572911838548985666324852393332778599743774366774285,
        58077225370726416004663044712935584550145451742743928661181035805663915703827,
        104439251539480106926161113951370634024631778870264997712356738825732753937447,
        53439459516819161945040092306752316561862163666206987751036168320706200062230,
        17787499004895197030057857045443617057110636566865078701097957524304091430931,
        47749595619106834572452345840395108832243018739768135492054520160618235123732,
        22763168264392848870228969151084765108640807544552472940159148314781379255835,
        31451578301083000856148820390234287377632706811358310419223547381181402014982,
        59571894486987910130385247606776622671830156664435658696842908373358334846512,
        74791757893869045805910909164958404333431890830481911488019828366943376316444,
        29563176747038421690311509095226822211048711924562436997720951348054799363095,
        11357502361464861373955561178558780611123409544610532321236197083917658828040,
        40243160898130263011886133051303920032169472667023592438011691170316140378412,
        61161865482340336327664833663371346498186029171346371498982435923191228850199,
        95568969580142483134815975374295285166124492041560414543047459880047925115936,
        50250211737205449182397541011222830533206972349544396293189639046471598570753,
        91045073293540057096492025989389740747116594806143431179426513174466770733069,
        320833924325562667876680420066552501860247178104773845746985240383412776745,
        98662877103137775005556700629364948786078065277528507995311892823101694144774,
        110737723815647064194119328574801121628107494500937992093116791894675870781478,
        40611943761337510016374754459067184018322203002325990976332840470214601726245,
        23931375083617530812827011862214586863307257177582435575618942570887107843873,
        48479324022432131196836361409070244683317938960824296346288573994068993725468,
        41697342956521383904537616997374527065543627030815147662364472867722670048542,
        43264740261693747536011568758988144574770026317446119532330891821540015142678,
        112540346085411027110308569320477516687022831847335374311219239932313391422765,
        102074244371325764546259286835492206019989905504597622095425900081130392429090,
        103696138191015396977114923384117685539689096882648190425474176924931281782547,
        28951074610574248347860600251709593665332645693558037029637648148955257346570,
        86081192808304659919333077793219847760231511431401434080590701098768925139238,
        1634220926551871268509576977118529499913823408915137251599394710627086044201,
        90677669291377917833025515439559400394112344100258993002568659051231319646990,
        75724750358077608374201947472862809055578305467644988817059938385141424444204,
        90787746989387968973319854731192817981043117063323540104307051685196446060581,
        105081697846683446112800599558496951907860632869542175806417486088302633985320,
        16815609247713275611675311918161736014159435044591501947549022283304964279827,
        59614998192175629910165682229015593498843999653246930604386227354620585235486,
        48198577540808097421354943087398981911599943975264938064498828735564243578373,
        24206173515026186490245415344405812438459905464697883906119576376300058918673,
        100891989875032992431792024199449503759393662986166024974680369901778447796501,
        114926937998193225776461182284513568170727662935324922176995952778158555251744,
        47955845841018446871134658140019220639066533240004308527734151350881273090077,
        67958716664552458151443812441025546869796532654463017964441269462721337588998,
        67742388972680712132146970758320580015432527003458806494233169968887197611029,
        36861463815526178254902222015047545313354926220412493566760378052253430317835,
        98417764973384228876601855896312986458779464608942721466928240027943433106193,
        5761883001756648503885190719694956898297410338325572762789960004672288372493,
        43262658212727304376998808176960283812170092174377657071654317231284653743619,
        108671506800488219751360625782654065004338633725177846366419848551679094093581,
        98774018075633866470288173209516537929941498699169073610514087982598304614432,
        16406097339460203315058549138093708940824229256470255715085322237537868698919,
        94955745890370069797666734563429054323654491359949265573605169677837637956895,
        56022714063725687233244672486173635905901696669268280332714515356890554851348,
        52530541102837525532651260693718555525166575321763854140842818130473879879446,
        8342307891845895890109322580677803084614925651268941032889707755518292200967,
        74215341786068904364409180940772157413069836156620123206791362962636697196046,
        23452271890108999915859519531465676959892847695685646050740628361155357607715,
        55919107774006423470657832704079102900739446029191165421713801991395929760043,
        97444994280597101905204993651111842413658112924346152619927559279776399513121,
        108602694853706529496874705936813037314139249028807251673887241100406089883652,
        99609818411907679435729828068532757035184265143215900817490548919133285683757,
        32388710283707974298156997180210866732309652982544070356018285810418157803527,
        13417512026241288147805740910223166224133378780956531002456007692692720228358,
        16494200623205296850016484527211974655599406490114546801911213130508936205577,
        9388976909436124441951964598311328868078392564983777411425137336133004419593,
        61853185110467735294504482315916759607676306438663538979625134792036188577326,
        45039483815891879387760485636456833036466451801776016976872731339578082379039,
        115398517141534997013863794998410848673764162932738947719007404361631786833446
      ];
      var t;
    signal t2[nrounds];
    signal t4[nrounds];
    signal t6[nrounds];
    signal t7[nrounds-1];

    for (var i=0; i<nrounds; i++) {
        t = (i==0) ? k+x_in : k + t7[i-1] + c[i];
        t2[i] <== t*t;
        t4[i] <== t2[i]*t2[i];
        t6[i] <== t4[i]*t2[i];
        if (i<nrounds-1) {
            t7[i] <== t6[i]*t;
        } else {
            out <== t6[i]*t + k;
        }
    }
}